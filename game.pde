/* @pjs preload="tileset.png, character.png"; */
PImage[] fragment;
var m=new tilemap();
var p;
int n=10;
var mapHeight;
var mapWidth;
var cam;
var pg;

var barMap=[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
            [0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0],
            [0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0],
            [0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0],
            [0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0],
            [0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0],
            [0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0],
            [0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0],
            [0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0],
            [0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0],
            [0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0],
            [0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0],
            [0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0],
            [0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0],
            [0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0],
            [0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0],
            [0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0],
            [0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0],
            [0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0],
            [0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0],
            [0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0],
            [0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0],
            ];
var tMap = [[176,177,176,177,176,177,176,177,176,177,176,177,176,177,176,177,176,177,176,177,176,177,176,177],
            [184,185,184,185,184,185,184,185,184,185,184,185,184,185,184,185,184,185,184,185,184,185,184,185],
            [176,177,462,462,462,462,462,462,462,462,462,462,462,462,462,462,462,462,462,462,462,462,176,177],
            [184,185,462,462,462,462,462,462,462,462,462,462,462,462,462,462,462,462,462,462,462,462,184,185],
            [176,177,462,462,462,462,462,462,462,462,462,462,462,462,462,462,462,462,462,462,462,462,176,177],
            [184,185,462,462,462,462,462,462,462,462,462,462,462,462,462,462,462,462,462,462,462,462,184,185],
            [176,177,462,462,462,462,462,462,462,462,462,462,462,462,462,462,462,462,462,462,462,462,176,177],
            [184,185,462,462,462,462,462,462,462,462,462,462,462,462,462,462,462,462,462,462,462,462,184,185],
            [176,177,462,462,462,462,462,462,462,462,462,462,462,462,462,462,462,462,462,462,462,462,176,177],
            [184,185,462,462,462,462,462,462,462,462,462,462,462,462,462,462,462,462,462,462,462,462,184,185],
            [176,177,462,462,462,462,462,462,462,462,462,462,462,462,462,462,462,462,462,462,462,462,176,177],
            [184,185,462,462,462,462,462,462,462,462,462,462,462,462,462,462,462,462,462,462,462,462,184,185],
            [176,177,462,462,462,462,462,462,462,462,462,462,462,462,462,462,462,462,462,462,462,462,176,177],
            [184,185,462,462,462,462,462,462,462,462,462,462,462,462,462,462,462,462,462,462,462,462,184,185],
            [176,177,462,462,462,462,462,462,462,462,462,462,462,462,462,462,462,462,462,462,462,462,176,177],
            [184,185,462,462,462,462,462,462,462,462,462,462,462,462,462,462,462,462,462,462,462,462,184,185],
            [176,177,462,462,462,462,462,462,462,462,462,462,462,462,462,462,462,462,462,462,462,462,176,177],
            [184,185,462,462,462,462,462,462,462,462,462,462,462,462,462,462,462,462,462,462,462,462,184,185],
            [176,177,462,462,462,462,462,462,462,462,462,462,462,462,462,462,462,462,462,462,462,462,176,177],
            [184,185,462,462,462,462,462,462,462,462,462,462,462,462,462,462,462,462,462,462,462,462,184,185],
            [176,177,176,177,176,177,176,177,176,177,176,177,176,177,176,177,176,177,176,177,176,177,176,177],
            [184,185,184,185,184,185,184,185,184,185,184,185,184,185,184,185,184,185,184,185,184,185,184,185]
            ];
var ground =[[563,563,563,563,563,563,563,563,563,563,563,563,563,563,563,563,563,563,563,563,563,563,563,563],
            [563,563,563,563,563,563,563,563,563,563,563,563,563,563,563,563,563,563,563,563,563,563,563,563],
            [563,563,563,563,563,563,563,563,563,563,563,563,563,563,563,563,563,563,563,563,563,563,563,563],
            [563,563,563,563,563,563,563,563,563,563,563,563,563,563,563,563,563,563,563,563,563,563,563,563],
            [563,563,563,563,563,563,563,563,563,563,563,563,563,563,563,563,563,563,563,563,563,563,563,563],
            [563,563,563,563,563,563,563,563,563,563,563,563,563,563,563,563,563,563,563,563,563,563,563,563],
            [563,563,563,563,563,563,563,563,563,563,563,563,563,563,563,563,563,563,563,563,563,563,563,563],
            [563,563,563,563,563,563,563,563,563,563,563,563,563,563,563,563,563,563,563,563,563,563,563,563],
            [563,563,563,563,563,563,563,563,563,563,563,563,563,563,563,563,563,563,563,563,563,563,563,563],
            [563,563,563,563,563,563,563,563,563,563,563,563,563,563,563,563,563,563,563,563,563,563,563,563],
            [563,563,563,563,563,563,563,563,563,563,563,563,563,563,563,563,563,563,563,563,563,563,563,563],
            [563,563,563,563,563,563,563,563,563,563,563,563,563,563,563,563,563,563,563,563,563,563,563,563],
            [563,563,563,563,563,563,563,563,563,563,563,563,563,563,563,563,563,563,563,563,563,563,563,563],
            [563,563,563,563,563,563,563,563,563,563,563,563,563,563,563,563,563,563,563,563,563,563,563,563],
            [563,563,563,563,563,563,563,563,563,563,563,563,563,563,563,563,563,563,563,563,563,563,563,563],
            [563,563,563,563,563,563,563,563,563,563,563,563,563,563,563,563,563,563,563,563,563,563,563,563],
            [563,563,563,563,563,563,563,563,563,563,563,563,563,563,563,563,563,563,563,563,563,563,563,563],
            [563,563,563,563,563,563,563,563,563,563,563,563,563,563,563,563,563,563,563,563,563,563,563,563],
            [563,563,563,563,563,563,563,563,563,563,563,563,563,563,563,563,563,563,563,563,563,563,563,563],
            [563,563,563,563,563,563,563,563,563,563,563,563,563,563,563,563,563,563,563,563,563,563,563,563],
            [563,563,563,563,563,563,563,563,563,563,563,563,563,563,563,563,563,563,563,563,563,563,563,563],
            [563,563,563,563,563,563,563,563,563,563,563,563,563,563,563,563,563,563,563,563,563,563,563,563],
            ];
mapHeight = (tMap.length)*32;
mapWidth = (tMap[0].length)*32;
cam = new cameraObj(mapHeight,mapWidth);


var keys=[];
void keyPressed(){keys[keyCode] = true; };
void keyReleased() { keys[keyCode] = false; };

void setup(){
    size(400, 400,P2D);
    pg = createGraphics(mapWidth, mapHeight,P2D);
    m.initMap(pg,tMap,ground,mapWidth,mapHeight);
    p=new player(200,200);
}

void draw(){
    background(100);
    stroke(255);
    pushMatrix();
    cam.update(p);
    image(pg,0,0);
    
    p.display();
    if (keys[68]) {//right
        p.isMoving=1;
        p.m_dir=2;
        
    }
    else if (keys[65]) {//left
        p.isMoving=1;
        p.m_dir=1;
    }
    else if (keys[87]) {//up
        p.isMoving=1;
        p.m_dir=3;
       
    }
    else if (keys[83]) {//down
        p.isMoving=1;
        p.m_dir=0;
    }
    else{
        p.isMoving=0;
        state=1;
        prevState=0;
    }
    popMatrix();
};

